{% extends "base.html" %}
{% load i18n static rules wagtailcore_tags maps_tags %}

{% block title %}{{ object.title }} &mdash; {{ block.super }}{% endblock %}

{% block extra_js %}
    <script type="text/javascript" src="{% static 'leaflet.js' %}"></script>
    <script type="text/javascript" src="{% static 'a4maps/map_display_point.js' %}"></script>
{% endblock %}

{% block extra_css %}
    <link type="text/css" href="{% static 'leaflet.css'%}" rel="stylesheet" />
{% endblock %}

{% block content %}
    <div class="l-wrapper">
        <div class="l-center-6">
            <nav class="breadcrumbs" aria-label="{% trans 'breadcrumbs' %}">
                <ul>
                    <li>
                        <a href="{% url 'meinberlin_plans:plan-list' %}">
                            <i class="fa fa-arrow-left" aria-hidden="true"></i>
                            {% trans 'back to list of plans' %}</a>
                    </li>
                </ul>
            </nav>

            <div class="item-detail">
                <h1 class="item-detail__title">
                    {{ object.title }}
                </h1>

                <div class="item-detail__labels">
                    <span class="label label--secondary">{{ object.get_status_display }}</span>
                    {% if object.category %}
                        <span class="label">{{ object.category }}</span>
                    {% endif %}
                </div>

                <table>

                    <tr>
                    <td>{% trans 'Organisation' %}</td> <td>object.organisation.name</td>
                    </tr>

                    <tr>
                    <td>{% trans 'Location' %}</td><td>{{ object.point_label }}</td>
                    </tr>

                    <tr>
                    <td>{% trans 'Plan type' %}</td><td>{{ object.category }}</td>
                    </tr>

                    <tr>
                    <td>{% trans 'Participation' %}</td><td>
                            {% if object.participation == object.PARTICIPATION_YES %}
                                {% trans 'Yes, see detail (TODO: link)' %}</p>
                            {% elif object.planned == object.PARTICIPATION_UNDECIDED %}
                                {% trans 'TODO: undecided text' %}</p>
                            {% elif object.planned == object.PARTICIPATION_YES %}
                                {% trans 'TODO: participation yes text' %}</p>
                            {% endif %}
                    </td>
                    </tr>

                    <tr>
                    <td>{% trans 'Planed cost' %}</td><td>{{ object.cost }}â‚¬</td>
                    </tr>

                    <tr>
                    <td>{% trans 'Reference No.' %}</td> <td>{{ object.reference_number }}</td>
                    </tr>

                </table>

                <hr />

                {% if object.description %}
                    {{ object.description|richtext }}
                {% endif %}

                <hr />

                <h5>{% trans 'Contact' %}</h5>
                <p>{{ object.contact }}</p>

                <hr />

                <ul class="l-tiles-4">
                {% for project in object.projects.all %}
                {% if project and project.is_public and not project.is_draft %}
                {% include "meinberlin_projects/includes/project_list_tile.html" with project=project %}
                {% endif %}
                {% endfor %}
                </ul>

                <div class="item-detail__actions lr-bar">
                    {% has_perm 'meinberlin_plans.change_plan' request.user object.organisation as user_may_change %}
                    {% if user_may_change %}
                        <div class="dropdown dropdown--right lr-bar__right">
                            <button
                                    title="{% trans 'Actions' %}"
                                    type="button"
                                    class="dropdown-toggle btn btn--light btn--small"
                                    data-toggle="dropdown"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    id="idea-{{ object.pk }}-actions"
                            >
                                <i class="fa fa-ellipsis-h" aria-label="{% trans 'Actions' %}"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="idea-{{ object.pk }}-actions">
                                <li>
                                    <a
                                        href="{% url 'a4dashboard:plan-update' organisation_slug=object.organisation.slug pk=object.pk %}"
                                        class="dropdown-item"
                                        data-embed-target="external"
                                    >{% trans 'Edit' %}</a>
                                </li>
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
