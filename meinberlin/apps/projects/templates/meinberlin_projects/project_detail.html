{% extends "base.html" %}
{% load i18n rules thumbnail wagtailcore_tags meinberlin_project_tags offlineevent_tags contrib_tags ckeditor_tags static %}

{% block extra_js %}
  {{ block.super }}
  <script type="text/javascript" src="{% static 'dsgvo_video_embed.js' %}"></script>
{% endblock extra_js %}

{% block title %}{{ project.name }} â€” {{ block.super }}{% endblock title %}

{% block extra_messages %}
  {{ block.super }}

  {% if project.is_draft %}
    {% include 'meinberlin_contrib/components/info-box.html' with info_message='This project has not yet been published.' %}
  {% endif %}
{% endblock extra_messages %}

{% block breadcrumbs %}
  <div id="content-header">
    <nav class="breadcrumb" aria-label='{% translate "You are here:" %}'>
      <ol>
        <li><a href="{% url 'wagtail_serve' '' %}">meinBerlin</a></li>
        <li>
          <a href="{% url 'meinberlin_plans:plan-list' %}">{% translate "Kiezradar" %}</a>
        </li>
        <li class="active" aria-current="page">{{ project.name|truncatechars:50 }}</li>
      </ol>
    </nav>
  </div>
{% endblock breadcrumbs %}

{% block content %}
  <div class="layout-grid__area--maincontent">
    {% url 'project-information' slug=project.slug as info_page %}
    {% include 'meinberlin_contrib/components/hero.html' with content=project show_buttons=True hero_link=info_page %}

    <section aria-labelledby="project-{{ project.pk }}-details">
      <h2 class="mt-0" id="project-{{ project.pk }}-details">{% translate "Project details" %}</h2>
      <ul>
        <li>
          {% translate "Organisation" %}<br />
          {{ project.organisation }}
        </li>
        {% if project.topics %}
          <li>
            {% translate "Topics" %}<br />
            {% for topic in project.topics.all %}
              {{ topic }}
            {% endfor %}
          </li>
        {% endif %}
        {% if project.administrative_district %}
          <li>
            {% translate "District" %}<br />
            {{ project.administrative_district }}
          </li>
        {% endif %}
        <li>
          {% translate "Project status" %}<br />
          {% if project.phases.active_phases %}
            {% translate 'running' %}
          {% elif project.phases.future_phases %}
            {% translate 'upcoming' %}
          {% else %}
            {% translate 'ended' %}
          {% endif %}
        </li>
      </ul>
    </section>
    <section aria-labelledby="project-{{ project.pk }}-participation">
      <h2 class="mt-0" id="project-{{ project.pk }}-participation">{% translate "Participate" %}</h2>
      {% if event %}
        <article>
          <h2>{{ event.name }}</h2>
          <div class="phase-info__item__subtitle">
            {% html_date event.date 'DATETIME_FORMAT' %}
          </div>
          <p>{{ event.description | safe | transform_collapsibles | richtext }}</p>
        </article>
      {% elif view.is_project_view %}
        <ul class="list--clean">
          {% for module in modules %}
            <li>
              {% include "meinberlin_projects/includes/project_module_tile.html" with project=project module=module %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <!-- if just one module and no phase view to dispatch to -->
        <div class="modul-servicepanel fullwidth panel--heavy phase-info">
          <div class="servicepanel__main">
            {% include "a4modules/includes/module_detail_phase.html" %}
          </div>
          <!-- these blocks are only filled when in phase view -->
          <div class="servicepanel__right phase-info__cta">
            {% block project_action %}{% endblock project_action %}
          </div>
        </div>
      {% endif %}
      {% block voting_token_field %}{% endblock voting_token_field %}
      {% block phase_content %}{% endblock phase_content %}
    </section>
    <section aria-labelledby="tab-project-{{ project.pk }}-result">
      <h2 class="mt-0" id="tab-project-{{ project.pk }}-result">{% translate "Result" %}</h2>
      {% if project.result %}
        <div class="ck-content">
          {{ project.result | transform_collapsibles | disable_iframes | richtext }}
        </div>
      {% else %}
        <p>{% translate "No results yet." %}</p>
      {% endif %}
    </section>
  </div>
{% endblock content %}
