{% extends "base.html" %}
{% load i18n rules react_follows thumbnail wagtailcore_tags meinberlin_project_tags offlineevent_tags contrib_tags ckeditor_tags static %}

<!-- Extra blocks to ensure cookie banner for live stream -->
{% block extra_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'dsgvo_video_embed.css' %}"/>
{% endblock extra_css %}

{% block extra_js %}
  {{ block.super }}
  <script type="text/javascript" src="{% static 'dsgvo_video_embed.js' %}"></script>
{% endblock extra_js %}

{% block title %}
  {{ project.name }}
  â€“
  {{ block.super }}
{% endblock title %}

{% block extra_messages %}
  {{ block.super }}

  {% if project.is_draft %}
    <ul class="messages">
      <li class="alert alert--warning" role="alert">
        <div class="container">
          {% translate 'This project is not published yet.' %}
        </div>
      </li>
    </ul>
  {% endif %}
{% endblock extra_messages %}

<!-- Breadcrumbs are only necessary for multimodule projects with simultaneously running modules since the project detail
     template correctly displays breadcrumbs for other project -->
{% if module.is_in_module_cluster %}
  {% block breadcrumbs %}
    <div id="layout-grid__area--contentheader">
      <div id="content-header">
        <nav class="breadcrumb" aria-label="{% translate 'You are here:' %}">
          <ol>
            <li>
              <a href="{% url 'meinberlin_plans:plan-list' %}">{% translate 'Project Overview' %}</a>
            </li>
            <li>
              <a href="{% url 'project-detail' project.slug %}">{{ project.name|truncatechars:50 }}</a>
            </li>
            <li class="active" aria-current="page">{{ module.name|truncatechars:50 }}</li>
          </ol>
        </nav>
      </div>
    </div>
  {% endblock breadcrumbs %}
{% endif %}

{% block content %}
  <div id="layout-grid__area--herounit">
    {% if module.is_in_module_cluster %}
      <div class="u-align-right u-spacer-bottom-double">
        {% if module.previous_module_in_cluster %}
          <a class="button button--light" href="{% url 'module-detail' module.previous_module_in_cluster.slug %}">
            <i class="fa fa-chevron-left u-md-up-display-none"></i>
            <span class="u-md-down-display-none">{% translate 'Previous' %}</span>
          </a>
        {% endif %}
        <span class="u-spacer-left u-spacer-right">{{ module.readable_index_in_cluster }}
                    {% translate 'of' %}
          {{ module.module_cluster|length }}</span>
        {% if module.next_module_in_cluster %}
          <a class="button button--light" href="{% url 'module-detail' module.next_module_in_cluster.slug %}">
            <i class="fa fa-chevron-right u-md-up-display-none"></i>
            <span class="u-md-down-display-none">{% translate 'Next' %}</span>
          </a>
        {% endif %}
      </div>
    {% endif %}
    <div class="modul-video">
      <div class="mb-2">
        <a class="link link--back" href="{% url 'project-detail' project.slug %}">{% translate 'Back to the project' %}</a>
      </div>
      <h2 class="title">
        {{ module.name }}
        {% for phase in module.phases %}
          {% if phase == module.active_phase and live_stream %}
            <span class="pill pill--live">{% translate 'Live' context 'video' %}</span>
          {% endif %}
        {% endfor %}
      </h2>
      <p>{{ module.description }}</p>
      <div class="video-container">
        {% if live_stream %}
          <div class="ck-content">
            {{ live_stream.live_stream | disable_iframes | richtext }}
          </div>
        {% endif %}
      </div>
    </div>

    <section id="layout-grid__area--maincontent">
      <div class="modul-servicepanel fullwidth panel--heavy phase-info">
        <div class="servicepanel__main">
          {% include "a4modules/includes/module_detail_phase.html" %}
        </div>
        <div class="servicepanel__right phase-info__cta">
          {% block project_action %}{% endblock project_action %}
        </div>
      </div>

      {% block voting_token_field %}{% endblock voting_token_field %}
      {% block phase_content %}{% endblock phase_content %}
      {% if module.is_in_module_cluster %}
        <section class="participation-tile__wrapper">
          <div class="participation-tile__list-container">
            <h2 class="participation-tile__list-header">{% translate 'More from this online participation:' %}</h2>
            <ul class="u-list-reset participation-tile__list">
              {% for other_module in module.module_cluster %}
                {% if not other_module == module %}
                  {% include "meinberlin_projects/includes/project_module_tile.html" with project=project module=other_module %}
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        </section>
      {% endif %}
    </section>
  </div>{% endblock content %}
