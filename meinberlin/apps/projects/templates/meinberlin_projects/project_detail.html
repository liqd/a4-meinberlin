{% extends "base.html" %}
{% load i18n rules thumbnail wagtailcore_tags meinberlin_project_tags offlineevent_tags contrib_tags ckeditor_tags static %}

{% block extra_js %}
  {{ block.super }}
  <script type="text/javascript" src="{% static 'dsgvo_video_embed.js' %}"></script>
{% endblock extra_js %}

{% block title %}{{ project.name }} — {{ block.super }}{% endblock title %}

{% block extra_messages %}
  {{ block.super }}

  {% if project.is_draft %}
    {% include 'meinberlin_contrib/components/info-box.html' with info_message='This project has not yet been published.' %}
  {% endif %}
{% endblock extra_messages %}

{% block breadcrumbs %}
  <div id="content-header">
    <nav class="breadcrumb" aria-label='{% translate "You are here:" %}'>
      <ol>
        <li><a href="{% url 'wagtail_serve' '' %}">meinBerlin</a></li>
        <li>
          <a href="{% url 'meinberlin_plans:plan-list' %}">{% translate "Kiezradar" %}</a>
        </li>
        <li class="active" aria-current="page">{{ project.name|truncatechars:50 }}</li>
      </ol>
    </nav>
  </div>
{% endblock breadcrumbs %}

{% block content %}
  <div class="layout-grid__area--maincontent">
    {% url 'project-information' slug=project.slug as info_page %}
    {% include 'meinberlin_contrib/components/hero.html' with content=project show_buttons=True hero_link=info_page %}

    <section aria-labelledby="project-{{ project.pk }}-details">
      <h2 class="mt-0" id="project-{{ project.pk }}-details">{% translate "Project details" %}</h2>
      <ul class="figures-box {% spaceless %}
        {% if project.phases.active_phases %}
          figures-box--running
        {% elif project.phases.future_phases %}
          figures-box--upcoming
        {% else %}
          figures-box--ended
        {% endif %}
      {% endspaceless %}">
        <li class="figures-box__item">
          <h3>
            <i class="fas fa-globe" aria-hidden="true"></i>
            {% translate "Organisation" %}
          </h3>
          <strong>{{ project.organisation }}</strong>
        </li>
        {% if project.topics %}
          <li class="figures-box__item">
            <h3>
              <i class="fas fa-table-cells" aria-hidden="true"></i>
              {% translate "Topics" %}
            </h3>
            <strong>
              {% for topic in project.topics.all %}
                {{ topic }} <br/>
              {% endfor %}
            </strong>
          </li>
        {% endif %}
        {% if project.administrative_district %}
          <li class="figures-box__item">
            <h3>
              <i class="fas fa-map-location-dot" aria-hidden="true"></i>
              {% translate "District" %}
            </h3>
            <strong>{{ project.administrative_district }}</strong>
          </li>
        {% endif %}
        <li class="figures-box__item">
          <h3>
            <i class="fas fa-circle" aria-hidden="true"></i>
            {% translate "Status" %}
          </h3>
          <strong>
            {% if project.phases.active_phases %}
              {% translate 'running' %}
            {% elif project.phases.future_phases %}
              {% translate 'upcoming' %}
            {% else %}
              {% translate 'ended' %}
            {% endif %}
          </strong>
        </li>
      </ul>
    </section>
    <section aria-labelledby="project-{{ project.pk }}-participation">
      {% if events %}
        <article>
          <h2>{{ event.name }}</h2>
          <div class="actionable-list__header">
            <h2>{% translate "Offline Events" %}</h2>
          </div>
          <ul class="actionable-list">
            {% for event in events %}
              <li class="actionable-list__item actionable-list__item--hide-first-line">
                {% html_date event.date 'DATE_FORMAT' %} · {{ event.event_type }}
                <a href="{{ event.get_absolute_url }}" class="actionable-list__item__body">
                  <h4 class="my-0">{{ event.name }}</h4>
                  <div class="actionable-list__item__actions actionable-list__item__actions--inline">
                    <i class="bicon bicon-arrow-right" aria-hidden="true"></i>
                  </div>
                </a>
              </li>
            {% endfor %}
          </ul>
        </article>
      {% endif %}
      <h2 id="project-{{ project.pk }}-participation">{% translate "Online Participation" %}</h2>
      <ul class="list--clean flexgrid grid--3 grid--stretch">
        {% get_sorted_modules as modules %}
        {% for module in modules %}
          <li>
            {% include "meinberlin_projects/includes/project_module_tile.html" with project=project module=module %}
          </li>
        {% endfor %}
      </ul>
    </section>
    <section aria-labelledby="tab-project-{{ project.pk }}-result">
      <h2 class="mt-0" id="tab-project-{{ project.pk }}-result">{% translate "Result" %}</h2>
      {% if project.result %}
        <div class="ck-content">
          {{ project.result | transform_collapsibles | disable_iframes | richtext }}
        </div>
      {% else %}
        <p>{% translate "No results yet." %}</p>
      {% endif %}
    </section>
  </div>
{% endblock content %}
