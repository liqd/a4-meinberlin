{% load i18n project_tags meinberlin_project_tags contrib_tags thumbnail static %}
{% project_tile_image project as project_image %}
{% project_tile_image_copyright project as project_image_copyright %}

<li class="maplist-item__vertical">
    <a href="{{ project|project_url }}" target="{{ project|is_external|yesno:"_blank,_self" }}">

        <div class="maplist-item__proj">
            {% if project_image %}
            <div class="maplist-item__img" alt="" style="background-image: url({{ project_image|thumbnail_url:'project_tile' }})">
                {% if project.topics %}
                <div class="maplist-item__label-img">
                    {% for topic in project.topic_names %}
                    <span class="label label--secondary maplist-item__label u-spacer-bottom-half">
                    {{ topic }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if project_image_copyright %}
                  <span class="maplist-item__img-copyright copyright">Â© {{ project_image_copyright }}</span>
                {% endif %}
            </div>
            {% endif %}
            <div class="maplist-item__content">
                {% if project.topics and not project_image %}
                <div class="maplist-item__label-spacer">
                    {% for topic in project.topic_names %}
                    <span class="label label--secondary maplist-item__label u-spacer-bottom-half">
                    {{ topic }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                <span class="maplist-item__roofline">
                {% if project.administrative_district %}
                {{ project.administrative_district }}
                {% else %}
                {% trans 'City wide' %}
                {% endif %}
                </span>
                <h3 class="maplist-item__title">{{ project.name }}</h3>
                <div class="maplist-item__description">
                  <span>{{ project.description }}</span>
                </div>
                <div class="maplist-item__link"></div>
                {% if project|is_container %}
                <div class="maplist-item__stats">
                    <span class="maplist-item__proj-count">
                        <i class="fas fa-th" aria-hidden="true"></i>
                        {% trans 'Participation projects: ' %}
                    </span>
                    <span>{{ project.projectcontainer.total_project_count }}</span>
                    <br />
                    <span class="maplist-item__status">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        {% trans 'Participation: ' %}
                    </span>
                    {% if project.projectcontainer.active_project_count > 0 %}
                    <span class="maplist-item__status-active">{% trans 'running' %}</span>
                    {% elif project.projectcontainer.future_project_count > 0 %}
                    <span class="maplist-item__status-active">{% trans 'starts in the future' %}</span>
                    {% else %}
                    <span class="maplist-item__status-inactive">{% trans 'done' %}</span>
                    {% endif %}
                </div>
                {% elif not project|is_external or project.externalproject.phase.start_date %}
                    {% if project.active_phase %}
                    <div class="status-item status__active">
                        <div class="status-bar__active">
                            <span class="status-bar__active-fill" style="width: {{ project.active_phase_progress }}%"></span>
                        </div>
                        <span class="maplist-item__status">
                            <i class="fas fa-clock" aria-hidden="true"></i>
                        {% blocktrans with time_left=project.time_left %}remaining {{ time_left }}{% endblocktrans %}
                        </span>
                    </div>
                    {% elif project.future_phases %}
                    <div class="status-item status__future">
                        <span class="maplist-item__status"><i class="fas fa-clock"  aria-hidden="true"></i>{% html_date project.future_phases.first.start_date 'd.m.Y' as start_date %}
                        {% blocktrans with date=start_date %}Participation: starts on {{ date }}{% endblocktrans %}
                        </span>
                    </div>
                    {% elif project.has_finished %}
                        <div class="status-item status-bar__past">
                        {% blocktrans %}Participation ended. Read result{% endblocktrans %}
                        </div>
                    {% endif %}
                {% endif %}

            </div>
            <div class="status-item_spacer"></div>
        </div>
        {% if project|is_external %}
        <div class="maplist-item__link-img"></div>
        {% endif %}
    </a>
</li>
