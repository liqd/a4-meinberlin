{% extends "base.html" %}
{% load i18n rules react_follows thumbnail wagtailcore_tags meinberlin_project_tags offlineevent_tags contrib_tags ckeditor_tags static %}

{% block extra_css %}
  {{ block.super }}
    <link rel="stylesheet" href="{% static 'dsgvo_video_embed.css' %}" />
{% endblock %}

{% block extra_js %}
  {{ block.super }}
    <script type="text/javascript" src="{% static 'dsgvo_video_embed.js' %}"></script>
{% endblock %}

{% block title %}{{project.name}} &mdash; {{ block.super }}{% endblock %}

{% block extra_messages %}
    {{ block.super }}

    {% if project.is_draft %}
        <ul class="messages">
            <li class="alert alert--warning" role="alert">
                <div class="container">
                    {% translate 'This project is not published yet.' %}
                </div>
            </li>
        </ul>
    {% endif %}
{% endblock %}

{% block breadcrumbs %}
    <div id="content-header">
        <nav class="breadcrumb" aria-label="{% translate 'You are here:' %}">
            <ol>
                <li><a href="/">meinBerlin</a></li>
                <li><a href="{% url 'meinberlin_plans:plan-list' %}">{% translate 'Project Overview' %}</a></li>
                <li class="active" aria-current="page">{{ project.name|truncatechars:50 }}</li>
            </ol>
        </nav>
    </div>
{% endblock %}

{% block content %}
<!-- FIXME according to the marketing verticle the herounit should be before the maincontent however the styling for this here is nested within maincontent
assume this will may be updated at somepoint  -->
<div id="layout-grid__area--maincontent">
    <section class="herounit-image-with-aside fullwidth">
        <div class="mainbar">
            <div class="mainbar__left">
                <div class="image">
                    <div class="image__image">
                        <img src="{{ project.image |thumbnail_url:'heroimage' }}" alt="{% if project.image_alt_text %}{{ project.image_alt_text }}{% else %}{% translate 'Here you can find a decorative picture.' %}{% endif %}" />
                    </div>
                </div>
            </div>
            <div class="mainbar__right">
                <div class="panel--heavy panel--remove-inner-panels flex--stretch-inner __py-0__">
                    <h1 class="title">{{ project.name }}</h1>
                    <div class="block">
                        <p>{{ project.description }}</p>
                        <p class="image__copyright image__copyright--aside">
                            {% if project.image_copyright %}
                                {{ project.image_copyright }}
                            {% else %}
                                {% translate 'copyright missing' %}
                            {% endif %}
                        </p>
                    </div>
                    <!-- Follow btn -->
                    <div class="follow__container">
                        {% react_follows project %}
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="js-tabs">
        <div class="row row--reverse-palm">
            {% has_perm 'a4projects.change_project' request.user view.project as user_may_change %}
            {% if user_may_change %}
            <div class="span4 align--right">
                <a class="link--edit" href="{% url 'a4dashboard:project-edit' project_slug=project.slug %}">
                    {% translate 'Edit' %}
                </a>
            </div>
            {% endif %}
            <div class="span8">
                <div role="tablist"
                    aria-label="{% translate 'Project Details Navigation' %}">
                    <button id="tab-project-{{ project.pk }}-information"
                        class="tab__button"
                        type="button"
                        role="tab"
                        aria-selected="false"
                        aria-controls="tabpanel-project-{{ project.pk }}-information"
                        tabindex="-1">
                            {% translate 'About the Project' %}
                    </button>
                    <button
                        id="tab-project-{{ project.pk }}-participation"
                        class="tab__button"
                        type="button"
                        role="tab"
                        aria-selected="true"
                        aria-controls="tabpanel-project-{{ project.pk }}-participation">
                            {% translate 'Participation' %}
                    </button>
                    <button
                        id="tab-project-{{ project.pk }}-result"
                        class="tab__button"
                        type="button"
                        role="tab"
                        aria-selected="false"
                        aria-controls="tabpanel-project-{{ project.pk }}-result"
                        tabindex="-1">
                            {% translate 'Results' %}
                    </button>
                </div>
            </div>
            <hr class="no-space"/>
        </div>
        <section
            id="tabpanel-project-{{ project.pk }}-information"
            class="tabpanel"
            role="tabpanel"
            aria-expanded="false"
            aria-hidden="true"
            aria-labelledby="tab-project-{{ project.pk }}-information">
            <div class="ck-content">
                {{ project.information | transform_collapsibles | disable_iframes | richtext }}
            </div>
            {% if project.contact_name or project.contact_address_text or project.contact_email or project.contact_phone or project.contact_url or project.organisation.address or project.organisation.url %}
                {% if project.contact_name or project.contact_address_text or project.contact_email or project.contact_phone or project.contact_url %}
                    <div>
                        <h3>{% translate 'Contact for questions' %}</h3>
                        <address>
                            {% if project.contact_name %}
                            <p>{{ project.contact_name }}</p>
                            {% endif %}
                            {% if project.contact_address_text %}
                            <p>{{ project.contact_address_text|linebreaks }}</p>
                            {% endif %}
                            {% if project.contact_phone %}
                            <p><strong>{% translate 'Telephone' %}: </strong>{{ project.contact_phone }}</p>
                            {% endif %}
                            {% if project.contact_email %}
                            <a class="btn btn--secondary" href="mailto:{{ project.contact_email }}">
                                {% translate 'Email' %}
                            </a>
                            {% endif %}
                            {% if project.contact_url %}
                            <a class="btn btn--secondary" target="_blank" href="{{ project.contact_url }}">
                                {% translate 'Website' %}
                            </a>
                            {% endif %}
                        </address>
                    </div>
                {% endif %}

                {% if project.organisation.address or project.organisation.url %}
                    <div>
                        <h3>{% translate 'Responsible body' %}</h3>
                        <address>
                            {% if project.organisation.address %}
                            <p>{{ project.organisation.name }}</p>
                            <p>{{ project.organisation.address|linebreaks }}</p>
                            {% endif %}
                            {% if project.organisation.url %}
                            <a class="btn btn--secondary" target="_blank" href="{{ project.organisation.url }}">
                                {% translate 'Website' %}
                            </a>
                            {% endif %}
                        </address>
                    </div>
                {% endif %}
            {% endif %}
        </section>
        <section
            id="tabpanel-project-{{ project.pk }}-participation"
            class="tabpanel"
            role="tabpanel"
            aria-expanded="true"
            aria-hidden="false"
            aria-labelledby="tab-project-{{ project.pk }}-participation">
            {% if event %}
                <article>
                    <h2>{{ event.name }}</h2>
                    <div class="phase-info__item__subtitle">
                    {% html_date event.date 'DATETIME_FORMAT' %}
                    </div>
                    <p>{{ event.description | safe | transform_collapsibles | richtext }}</p>
                </article>
            {% elif view.is_project_view %}
                <div class="participation-tile__wrapper">
                    <div class="participation-tile__list-container">
                        <ul class="u-list-reset participation-tile__list">
                        {% for module in modules %}
                            {% include "meinberlin_projects/includes/project_module_tile.html" with project=project module=module %}
                        {% endfor %}
                        </ul>
                    </div>
                </div>
            {% else %} <!-- if just one module and no phase view to dispatch to -->
            {% include "a4modules/includes/module_detail_phase.html" %}
            {% endif %}
            <!-- these blocks are only filled when in phase view -->
            {% block project_action %}{% endblock %}
            
            {% block voting_token_field %}{% endblock %}
            {% block phase_content %}{% endblock %}
        </section>
        <section
            id="tabpanel-project-{{ project.pk }}-result"
            class="tabpanel"
            role="tabpanel"
            aria-expanded="false"
            aria-hidden="true"
            aria-labelledby="tab-project-{{ project.pk }}-result">
                {% if project.result %}
                    <div class="ck-content">
                        {{ project.result | transform_collapsibles | richtext }}
                    </div>
                {% else %}
                    {% translate 'No results yet.' %}
                {% endif %}
        </section>
    </div>
</div>
{% endblock %}
